{{> userHeader}}

<div class="container main-container headerOffset">
    <div class="row">
        <div class="breadcrumbDiv col-lg-12">
            <ul class="breadcrumb">
                <li><a href="/">Trang chủ</a></li>
                <li><a href="/account">Tài khoản của tôi</a></li>
                <li><a href="/account/orderList">Danh sách đơn hàng</a></li>
                <li class="active">Trạng thái đơn hàng</li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-9 col-md-9 col-sm-7">
            <h1 class="section-title-inner">
                <span><i class="fa fa-list-alt"></i> Trạng thái đơn hàng </span>
            </h1>
            <div class="row userInfo">
                <div class="col-lg-12">
                    <h2 class="block-title-2">Trạng thái đơn hàng của bạn</h2>
                </div>
                <div class="statusContent">
                    <div class="col-sm-12">
                        <div class="statusTop">
                            <p><strong>Trạng thái:</strong> {{orderData.orderStatus}}</p>
                            <p><strong>Ngày đặt hàng:</strong> {{orderData.orderDate}}</p>
                            <p><strong>Mã đơn hàng:</strong> #{{orderData.orderNumber}}</p>
                        </div>
                    </div>
                    <div class="col-sm-12">
                        <div id="cancelledBtn" style="display: none;" class="text-bg-danger p-3">Tải đơn hàng</div>
                    </div>
                    <div class="gap"></div>
                    {{#if isCancelled}}
                    <div class="col-sm-12">
                        <button class="btn btn-danger btn-lg btn-block">Đơn hàng đã bị hủy</button>
                    </div>
                    {{else}}
                    <div class="col-sm-12">
                        <div id="cancelBtn" class="btn btn-danger" onclick="cancelOrder('{{orderData._id}}')">Hủy đơn
                            hàng
                        </div>
                    </div>
                    {{/if}}
                    <div class="gap"></div>
                    <div class="col-sm-6">
                        <div class="order-box">
                            <div class="order-box-header">Địa chỉ</div>
                            <div class="order-box-content">
                                <div class="address">
                                    <p><strong>{{orderData.addressChosen.addressTitle}}</strong></p>
                                    <p><strong>{{orderData.addressChosen.firstName}} &nbsp;
                                            {{orderData.addressChosen.lastName}}</strong></p>
                                    <div class="adr">
                                        {{orderData.addressChosen.addressLine1}} <br />
                                        {{orderData.addressChosen.addressLine2}} <br /> Sđt:
                                        {{orderData.addressChosen.phone}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="clear: both"></div>
                </div>
                <div class="col-sm-12 clearfix">
                    <div class="order-box">
                        <div class="order-box-header">Danh sách sản phẩm</div>
                        <div class="order-box-content">
                            <div class="table-responsive">
                                <table class="order-details-cart">
                                    <tbody>
                                        {{#each orderData.cartData}}
                                        <tr class="cartProduct">
                                            <td class="cartProductThumb" style="width: 20%">
                                                <div>
                                                    <a href="/productDetails/{{this.productId._id}}">
                                                        <img alt="img"
                                                            src="{{this.productId.productImage1}}" />
                                                    </a>
                                                </div>
                                            </td>
                                            <td style="width: 40%">
                                            </td>
                                            <td class="" style="width: 10%"><a> X{{this.productQuantity}} </a>
                                            </td>
                                            <td class="" style="width: 15%">
                                                <span> {{this.totalCostPerProduct}}đ </span>
                                            </td>
                                        </tr>
                                        {{/each}}
                                        <tr class="cartTotalTr blank">
                                            <td class="" style="width:20%">
                                                <div></div>
                                            </td>
                                            <td style="width:40%"></td>
                                            <td class="" style="width:20%"></td>
                                            <td class="" style="width:15%"><span> </span></td>
                                        </tr>
                                        <tr class="cartTotalTr">
                                            <td class="" style="width:20%">
                                                <div></div>
                                            </td>
                                            <td colspan="2" style="width:40%"></td>
                                            <td class="" style="width:15%"><span> {{orderData.grandTotalCost}}đ</span>
                                            </td>
                                        </tr>
                                        <tr class="cartTotalTr">
                                            <td class="" style="width:20%">
                                                <div></div>
                                            </td>
                                            <td colspan="2" style="width:40%">Shipping</td>
                                            <td class="" style="width:15%"><span> Free </span></td>
                                        </tr>
                                        <tr class="cartTotalTr">
                                            <td class="" style="width:20%">
                                                <div></div>
                                            </td>
                                            <td style="width:40%"></td>
                                            <td class="" style="width:20%">Tổng cộng</td>
                                            <td class="" style="width:15%"><span
                                                    class="price">{{orderData.grandTotalCost}}đ </span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 clearfix">
                <ul class="pager">
                    <li class="previous pull-right">
                        <a href="/">
                            <i class="fa fa-home"></i> Trờ về cửa hàng
                        </a>
                    </li>
                    <li class="next pull-left">
                        <a href="/account"> ← Trờ về tài khoản của tôi</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-5"></div>
</div>
<script src="/assets/js/jquery/jquery-2.1.3.min.js"></script>
<script src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script src="/assets/js/footable.js" type="text/javascript"></script>
<script src="/assets/js/footable.sortable.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        $(".footable").footable();
    });
</script>
<script>
    async function cancelOrder(orderId) {
        Swal.fire({
            title: "Bạn chắc chắn chứ?",
            text: "Bạn sẽ không thể hoàn tác hành động này!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Chắc chắn!",
        }).then((result) => {
            if (result.isConfirmed) {
                fetch('/account/orderList/orderStatus/cancelOrder/' + orderId, { method: 'PUT' }).then(d => console.log(d))
                let cancelBtnElement = document.getElementById('cancelBtn')
                let cancelledBtnElement = document.getElementById('597a5bdf082df5a383c94b')

                cancelBtnElement.style.display = 'none'
                cancelledBtnElement.style.display = 'block'
                Swal.fire({
                    title: "Đơn hàng của bạn đã bị hủy.",
                    icon: "success"
                });
            }
        });
    }
</script>

{{> userFooter}}